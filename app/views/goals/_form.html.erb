<%= javascript_include_tag "goals" %>

<%= form_with(model: goal, local: true) do |form| %>
  <% if goal.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(goal.errors.count, "error") %> prohibited this goal from being saved:</h2>
      <ul>
      <% goal.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <br />

  <div class="row p-4">

    <%= form.hidden_field :phases_number, value:goal.phases_number, id:'phases_number_hid' %>

    <div class="col-sm-5">
      <%= form.label :goal_type_id, "Tipo de Objetivo", class:'form-label' %>
      <%= form.collection_select(:goal_type_id, GoalType.get_name_sorted, :id, :name, {include_blank:'SELECCIONE'}, {required:true, class:'form-control'}) %>
    </div>
    <div class="offset-sm-1 col-sm-5">
      <%= form.label :period_id, "Período", class:'form-label' %>
      <%= form.collection_select(:period_id, Period.get_name_sorted, :id, :name, {include_blank:'SELECCIONE'}, {required:true, class:'form-control'}) %>
    </div>

    <div class="col-sm-5">
      <%= form.label :evaluation_id, "Forma de Evaluación", class:'form-label' %>
      <%= form.collection_select(:evaluation_id, Evaluation.get_name_sorted, :id, :get_name_formula, {include_blank:'SELECCIONE'}, {required:true, class:'form-control'}) %>
    </div>
    <div class="offset-sm-1 col-sm-5">
      <%= form.label :name, "Nombre del Objetivo", class:'form-label' %>
      <%= form.text_field :name, required:true, pattern:'[A-Z0-9]*', title:t('general.messages.mayus_num'), class:'form-control' %>
    </div>

    <div class="col-sm-5">
      <%= form.label :percentaje, "Porcentaje", class:'form-label' %>
      <%= form.number_field :percentaje, required:true, max:100, min:1, title:t('general.messages.num'), class:'form-control' %>
    </div>
    <div class="offset-sm-1 col-sm-5">
      <%= form.label :phases_number, "Número de Fases", class:'form-label' %>
      <%= form.number_field :phases_number, required:true, max:20, min:1, title:t('general.messages.num'), id:'phases_number', class:'form-control' %>
    </div>


    <div id="phases_container" class="phases col-sm-12">
      <%= form.fields_for :phases do |phase| %>
        <%= render 'phase_fields', f: phase %>
      <% end %>
    </div>

    <div class="input-group">
      <%= link_to_add_association form, :phases, data: {association_insertion_node: '.phases', association_insertion_method: :append}, id:"phases_butt", hidden:true, class: "minibtn btn-default m-1" do %>
        <span class="fa">&#x2b;</span>
        Agregar Fase
      <% end %>
    </div>

  </div>

  <br />

  <div class="actions">
    <%= form.submit t('general.buttons.submit'), class:"btn btn-default floatRight" %>
  </div>
<% end %>
